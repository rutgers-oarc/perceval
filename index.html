<!DOCTYPE html>
<html lang=en>

<head>
    <meta charset=utf-8>
    <meta content="IE=edge" http-equiv=X-UA-Compatible>
    <meta content="width=device-width,initial-scale=1" name=viewport>
    <meta content="Amarel Community Resources" name=description>
    <meta content="Galen Collier" name=author>
    <title> Amarel Community Resources &middot; OARC </title>
    <link href=bootstrap.unminified.css rel=stylesheet>
    <link href=main.unminified.css rel=stylesheet>
    <link href=favicon.ico rel=icon>
</head>

<body>
    <a href=#content class="sr-only sr-only-focusable" id=skippy>
    
    <header class="bs-docs-nav navbar navbar-static-top" id=top>
        <div class=container>
            <div class=navbar-header>
                <button aria-controls=bs-navbar aria-expanded=false class="collapsed navbar-toggle" data-target=#bs-navbar data-toggle=collapse type=button> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a href=http://oarc.rutgers.edu/ class=navbar-brand>OARC Home</a> </div>
            <nav class="collapse navbar-collapse" id=bs-navbar>
                <ul class="nav navbar-nav">
                    <li class=active> <a href=../community/index.html>Amarel Community Resources</a>
                    </li>
                    <li> <a href=https://rutgers-oarc.github.io/amarel>Amarel</a>
                    </li>
                    <li> <a href=https://rutgers-oarc.github.io/perceval>Perceval</a>
                    </li>
                    <li> <a href=../experimental/>Experimental Platforms</a>
                    </li>
                </ul>
                <ul class="nav navbar-nav navbar-right">
                    <li><a href=http://oarc.rutgers.edu/events>Events</a></li>
                    <li><a href=http://oarc.rutgers.edu onclick='ga("send","event","Navbar","Community links","Research")'>Research</a></li>
                    <li><a href=https://oarc.rutgers.edu/people onclick='ga("send","event","Navbar","Community links","People")'>People</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <div class=bs-docs-header id=content tabindex=-1>
        <div class=container>
            <h2><strong>Amarel Community Resources <i>(BETA)</i></strong></h2>
            <p>Useful resources contributed or setup by members of the Amarel Research Computing Community for the benefit of fellow members</p>
        </div>
    </div>
    <div class="container bs-docs-container">
        <div class=row>
            <div class=col-md-9 role=main>

                <div class=bs-docs-section>
                <h3 class=page-header id=softwaremodules>Community-Contributed Software Modules</h3>
                <p class=lead>Users who wish to share software with the Amarel community of researchers can do so using the guidelines and suggestions presented here.</p>

                
                    <p><strong>Log-in to Amarel or Perceval and check out /projects/community</strong></p>
                    <p>Have you created a particularly fast build of your favorite simulation tool? Have you compiled a packaged that's notoriously hard to compile? Want to share some software with collaborators within the Amarel user community?</p>
                    <p>OARC has setup a dedicated repository for community-contributed software and associated modulefiles in /projects/community. All Amarel and Perceval users can contribute software to this repository. We have established some basic guidelines to help keep things organized.</p>
                    <br>
                    <p>If you would like to see the community-contributed software packages when you run the 'module avail' or 'module spider' command, add /projects/community/modulefiles to your MODULEPATH,
<figure class=highlight><pre><code class=language-html data-lang=html>$ export MODULEPATH=$MODULEPATH:/projects/community/modulefiles</code></pre></figure>
or add that line to your ~/.bashrc file for that setting to persist.</p>

<br>
<p><strong>A Note About Governance</strong></p>

<p>Please follow the guidelines presented here. The OARC research support team will remove or edit contributions that do not conform to these guidelines. If you find any problems or if you have questions, please let us know by sending a message to <a href=mailto:help@hpc.rutgers.edu>help@hpc.rutgers.edu</a></p>


<br>
<p><strong>User Support</strong></p>

<p>Contributed software is officially unsupported. However, individual users who setup contributed software may be willing to answer basic questions about useability, performance, or selected build options. We certainly want to encourage users to contribute software, but at the same time, we do not want to burden busy researchers with support expectations. Be considerate if you contact a user about contributed software.</p>


<br>
<p><strong>Permissions</strong></p>

<p>We've adjusted permissions (and set the sticky bit) so Amarel and Perceval users can write to /projects/community and its subdirectories.
<figure class=highlight><pre><code class=language-html data-lang=html># chmod 777 /projects/community
# chmod o+t /projects/community</code></pre></figure>
This means that only a file's owner, a directory's owner, or root can rename or delete those files or directories, thus preventing others from modifying your contributions. You can adjust permissions of the files and directories you create, which may be necessary to enable others to use the software you place there.</p>


<br>
<p><strong>Naming Conventions</strong></p>

<p>New software packages should be added using the following conventions.</p>

<p><u>Modulefiles:</u><br>
/projects/community/modulefiles/compiler-name/version/mpi-name/version/CUDA/version/pkg-name/version/NetID</p>

<p><u>Core packages:</u><br>
/projects/community/pkg-name/version/NetID</p>

<p><u>Compiler dependent packages:</u><br>
/projects/community/compiler-name/version/pkg-name/version/NetID</p>

<p><u>Compiler dependent packages using CUDA:</u><br>
/projects/community/compiler-name/version/pkg-name/version/NetID</p>

<p><u>MPI-Compiler dependent packages:</u><br>
/projects/community/compiler-name/version/mpi-name/version/pkg-name/version/NetID</p>

<p><u>MPI-Compiler dependent packages using CUDA:</u><br>
/projects/community/compiler-name/version/mpi-name/version/cuda/version/pkg-name/version/NetID</p>


<br>
<p><strong>Good Housekeeping and Reproducibility in Research</strong></p>

<p>(1) All contributed software packages MUST have a README.OARC file created and stored in the directory containing the installed software. This file must include your contact info and any useful information about the software. This file should include all commands used to build the package since this information is important for anyone wishing to use contributed software for research purposes.</p>

<p>There is a long but useful example README.OARC file in /projects/community/gcc/7.3.0/gc563</p>

<p>(2) All contributed software packages MUST have an associated <a href=http://lmod.readthedocs.io/en/latest>Lmod modulefile</a> so users can easily access the software. There are details for doing this and examples below.</p>


<br>
<p><strong>An Example: GCC-7.3.0</strong></p>

<p>March 23, 2018: I want to build GCC, The GNU Compiler Collection, version 7.3.0 since a project I'm working on requires it, but GCC-7.3.0 is not already setup on Amarel. I'll begin by "bootstraping" using the core/default tools that come with the version of CentOS installed on Amarel. That version (at the time of this writing) is

<figure class=highlight><pre><code class=language-html data-lang=html>$ cat /etc/*release | head -n 1
CentOS Linux release 7.4.1708 (Core)</code></pre></figure>

plus the additional components and tools that come from the Enterprise Linux repository. This version of CentOS is based on the following kernel and GCC version:

<figure class=highlight><pre><code class=language-html data-lang=html>$ cat /proc/version
Linux version 3.10.0-693.21.1.el7.x86_64 (builder@kbuilder.dev.centos.org) (gcc version 4.8.5 20150623 (Red Hat 4.8.5-16) (GCC) ) #1 SMP Wed Mar 7 19:03:37 UTC 2018</code></pre></figure>

Installing GCC requires a few prerequisite packages: these must be installed and configured for use before installing GCC. Those prerequisites are:

GNU Multiple Precision Library (GMP) version 4.3.2 (or later)
MPFR Library version 2.4.2 (or later)
MPC Library version 0.8.1 (or later)

I'll download, test, and install a recent version of each of these software packages. Since I'm just trying to get setup for installing GCC here, I'll skip the description of these steps because I'll discuss those steps in detail later (below).

<figure class=highlight><pre><code class=language-html data-lang=html>$ wget https://gmplib.org/download/gmp/gmp-6.1.2.tar.bz2
$ tar -jxf gmp-6.1.2.tar.bz2
$ ./configure --prefix=/projects/community/gmp/6.1.2/gc563 --enable-cxx --enable-fft
$ make -j 4
$ make check
$ make install
$ cd .. ; rm -rf gmp-6.1.2*</code></pre></figure>

Note: the following environment settings are needed for installing the next package. These environment settings have not yet been set for my shell session, so that's why I'm not prepending them to existing path settings here:

<figure class=highlight><pre><code class=language-html data-lang=html>$ export C_INCLUDE_PATH=/home/gc563/gmp/6.1.2/include
$ export CPLUS_INCLUDE_PATH=/projects/community/gmp/6.1.2/gc563/include
$ export LIBRARY_PATH=/projects/community/gmp/6.1.2/gc563/lib
$ export LD_LIBRARY_PATH=/projects/community/gmp/6.1.2/gc563/lib</code></pre></figure>

<figure class=highlight><pre><code class=language-html data-lang=html>$ wget http://www.mpfr.org/mpfr-current/mpfr-4.0.1.tar.bz2
$ tar -jxf mpfr-4.0.1.tar.bz2 
$ cd mpfr-4.0.1
$ ./configure --prefix=/projects/community/mpfr/4.0.1/gc563 --enable-thread-safe
$ make -j 4
$ make install
$ cd .. ; rm -rf mpfr-4.0.1*</code></pre></figure>

Note: the following environment settings have already been set, so that's why I'm prepending additional segments to existing path settings here:

<figure class=highlight><pre><code class=language-html data-lang=html>$ export C_INCLUDE_PATH=/home/gc563/mpfr/4.0.1/include:$C_INCLUDE_PATH
$ export CPLUS_INCLUDE_PATH=/projects/community/mpfr/4.0.1/gc563/include:$CPLUS_INCLUDE_PATH
$ export LIBRARY_PATH=/projects/community/mpfr/4.0.1/gc563/lib:$LIBRARY_PATH
$ export LD_LIBRARY_PATH=/projects/community/mpfr/4.0.1/gc563/lib:$LD_LIBRARY_PATH</code></pre></figure>

<figure class=highlight><pre><code class=language-html data-lang=html>$ wget https://ftp.gnu.org/gnu/mpc/mpc-1.1.0.tar.gz
$ tar -zxf mpc-1.1.0.tar.gz
$ cd mpc-1.1.0
$ ./configure --prefix=/projects/community/mpc/1.1.0/gc563
$ make
$ make install
$ cd .. ; rm -rf mpc-1.1.0*</code></pre></figure>

<figure class=highlight><pre><code class=language-html data-lang=html>$ export C_INCLUDE_PATH=/home/gc563/mpc/1.1.0/include:$C_INCLUDE_PATH
$ export CPLUS_INCLUDE_PATH=/projects/community/mpc/1.1.0/gc563/include:$CPLUS_INCLUDE_PATH
$ export LIBRARY_PATH=/projects/community/mpc/1.1.0/gc563/lib:$LIBRARY_PATH
$ export LD_LIBRARY_PATH=/projects/community/mpc/1.1.0/gc563/lib:$LD_LIBRARY_PATH</code></pre></figure>

Now, I can finally start building GCC. I'll download the latest stable supported release of GCC, open the tarball, and get ready to install it:

<figure class=highlight><pre><code class=language-html data-lang=html>$ wget http://mirrors.concertpass.com/gcc/releases/gcc-7.3.0/gcc-7.3.0.tar.gz
$ tar -zxf gcc-7.3.0.tar.gz
$ cd gcc-7.3.0</code></pre></figure>

Like the 3 prerequisite software packages I just installed, the GCC compiler suite uses the traditional configure/make/make-install installation procedure. The first step is to run the Bash script named 'configure'. The configure script inspects the existing hardware and/or software configuration of the machine where you are about to install this new software. If something is needed and missing (e.g., a needed library or access to specific tools), the configure script should let you know. The result of running this script is the creation of a file named 'Makefile' that contains the instructions for compiling your new software based on the findings from the configure script.

In addition, when you run the configure script, you have the opportunity to select important options for how your new software will be setup. Most importantly, you can select where the software will be installed. This is accomplished using the '--prefix=[some location]' option. In my case, I'll specify a location in my /home directory. There are many other options and those options vary depending on what you're installing. To see a summary of the available options, use './configure --help' and for details about what those options mean, see the documentation for your new software.

<figure class=highlight><pre><code class=language-html data-lang=html>$ ./configure --prefix=/projects/community/gcc/7.3.0/gc563 --with-mpc=/projects/community/mpc/1.1.0/gc563 --with-mpfr=/projects/community/mpfr/4.0.1/gc563 --with-gmp=/projects/community/6.1.2/gc563 --disable-multilib</code></pre></figure>

Next, the 'make' utility will be used to compile your software. It requires the file named 'Makefile' that you created with the configure step. The Makefile indicates the sequence that an options to be used for building various components of your new software. The Makefile uses labels (i.e., names for different sections of the procedures contained therein), so entire sections of the Makefile can be skipped or used in a particular order.

Running 'make' to compile your code can take a long time for some packages. You can parallelize this step to some extent using the '-j [n]' option where n is the number of tasks you wish to run simultaneously. This isn't quite the same as running a parallel or multithreaded program, but it can help get a large number of compiling tasks done in a shorter time.

<figure class=highlight><pre><code class=language-html data-lang=html>$ make -j 8</code></pre></figure>

Finally, I need to copy my newly created executables and/or libraries to their final destinations (the location I specified with '--prefix=' in the configure step, above). One of the labels present in the Makefile is named 'install' and I can instruct make to run the commands under that label as follows:

<figure class=highlight><pre><code class=language-html data-lang=html>$ make install
$ cd .. ; rm -rf gcc-7.3.0*</code></pre></figure></p>



<p><strong>Modulefiles for Community-Contributed Packages</strong></p>

<p>All contributed software packages MUST have an associated <a href=http://lmod.readthedocs.io/en/latest>Lmod modulefile</a> so users can easily access the software.</p>

<p><u>Directory structure for modulefiles (omit parts that aren't used, like /CUDA/version or /mpi-name/version):</u><br>
/projects/community/modulefiles/compiler-name/version/mpi-name/version/CUDA/version/pkg-name/version/NetID</p>

<p>Here's an example Lmod modulefile for the GCC-7.3.0 example (above):</p>
<figure class=highlight><pre><code class=language-html data-lang=html>help(
[[
This module loads the GNU Compiler Collection version 7.3.0. 
The GNU Compiler Collection includes front ends for C, C++, Fortran, as well as libraries for these languages.
]])

whatis("Description: GCC: the GNU Compiler Collection")
whatis("URL: https://gcc.gnu.org")

conflict("gcc")

load("gmp/6.1.2-gc563")
load("mpfr/4.0.1-gc563")
load("mpc/1.1.0-gc563")

local base = pathJoin("/projects/community", myModuleName(), "7.3.0", "gc563")
prepend_path("PATH", pathJoin(base, "bin"))
prepend_path("C_INCLUDE_PATH", pathJoin(base, "include"))
prepend_path("CPLUS_INCLUDE_PATH", pathJoin(base, "include"))
prepend_path("LIBRARY_PATH", pathJoin(base, "lib64"))
prepend_path("LD_LIBRARY_PATH", pathJoin(base, "lib64"))
prepend_path("MANPATH", pathJoin(base, "share/man"))</code></pre></figure>

<p>Once created, this file should be named "7.3.0-gc563.lua" because that's the name that will appear in the list of modules when a user runs the 'module avail' or 'module spider' command.

<p><u>Understanding this file:</u></p>
<p>A 'conflict' can be specified to prevent loading a potentially conflicting module (e.g., loading 2 different versions of GCC at the same time)</p>
<p>In this example, 3 prerequisite modules are automatically loaded when this GCC module is loaded. Alternatively, you can simply specify a prerequisite using 'prereq("module/version")' to notify a user of a prerequisite without automatically trying to load it.</p>
<p>The 'local base' statement establishes the general path for your software's various subdirectories</p>
<p>The 'prepend_path' statements define the specific path additions for those subdirectories</p>




                </div>
            </div>
            <div class=col-md-3 role=complementary>
                <nav class="bs-docs-sidebar hidden-print hidden-sm hidden-xs">
                    <ul class="nav bs-docs-sidenav">
                        <li> <a href=#softwaremodules>Software Modules</a> </li>
                    </ul> <a href=#top class=back-to-top> Back to top </a> </nav>
            </div>
        </div>
    </div>
    <footer class=bs-docs-footer>
        <div class=container>
            <ul class=bs-docs-footer-links>
                <li><a href=http://oarc.rutgers.edu>Events</a></li>
                <li><a href=http://oarc.rutgers.edu>Research</a></li>
                <li><a href=http://oarc.rutgers.edu>People</a></li>
            </ul>
            <p>Comments or questions should be directed to <strong>Galen Collier</strong> ( <a href=mailto:galen.collier@rutgers.edu>galen.collier@rutgers.edu</a>, Rutgers office: 848.445.5237 )</p>
            <br>
            <p><a href=http://oarc.rutgers.edu>OARC</a> 2018</p>
        </div>
    </footer>
    <script src=https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js></script>
    <script src=bootstrap.min.js></script>
    <script src=docs.min.js></script>
    <script>
        var _gauges = _gauges || [];
        ! function() {
            var e = document.createElement("script");
            e.async = !0, e.id = "gauges-tracker", e.setAttribute("data-site-id", "4f0dc9fef5a1f55508000013"), e.src = "//secure.gaug.es/track.js";
            var t = document.getElementsByTagName("script")[0];
            t.parentNode.insertBefore(e, t)
        }()
    </script>